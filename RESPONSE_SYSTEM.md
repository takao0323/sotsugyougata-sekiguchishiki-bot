# è‡ªå‹•è¿”ä¿¡ã‚·ã‚¹ãƒ†ãƒ  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ğŸ“– æ¦‚è¦

ãƒ€ã‚¤ã‚¨ãƒƒãƒˆãƒ¡ãƒ³ã‚¿ãƒ¼ã®è‡ªå‹•è¿”ä¿¡ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®è³ªå•ã‚„æ‚©ã¿ã«å¯¾ã—ã¦ã€æ¸©ã‹ãå‰å‘ããªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚

**ç‰¹å¾´:**
- ğŸ”¢ **2å„„ãƒ‘ã‚¿ãƒ¼ãƒ³ä»¥ä¸Š**ã®è¿”ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- ğŸ¤– **AIè‡ªå‹•åˆ†é¡**ï¼ˆGoogle Geminiä½¿ç”¨ï¼‰
- ğŸ“ **9ã¤ã®ã‚«ãƒ†ã‚´ãƒª**ã§é©åˆ‡ãªè¿”ä¿¡
- ğŸ’¬ **æ¸©ã‹ãå‰å‘ã**ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°

## ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

### 1. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆmessage_templates.pyï¼‰

#### ã‚«ãƒ†ã‚´ãƒªï¼ˆ9ç¨®é¡ï¼‰
1. **é£Ÿäº‹ãƒ»æ „é¤Š** - é£Ÿäº‹åˆ¶é™ã€ã‚«ãƒ­ãƒªãƒ¼ã€PFCãƒãƒ©ãƒ³ã‚¹ãªã©
2. **é‹å‹•ãƒ»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°** - ç­‹ãƒˆãƒ¬ã€æœ‰é…¸ç´ é‹å‹•ã€æ™‚é–“ç¢ºä¿ãªã©
3. **ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ¡ãƒ³ã‚¿ãƒ«** - ã‚„ã‚‹æ°—ã€ç¶™ç¶šã€å¿ƒã®æ‚©ã¿ãªã©
4. **åœæ»æœŸ** - ä½“é‡ãŒæ¸›ã‚‰ãªã„ã€å¤‰åŒ–ãŒãªã„ãªã©
5. **ä½“é‡å¢—åŠ ãƒ»ãƒªãƒã‚¦ãƒ³ãƒ‰** - ä½“é‡ãŒå¢—ãˆãŸã€æˆ»ã£ãŸãªã©
6. **æ™‚é–“ç®¡ç†** - å¿™ã—ã„ã€æ™‚é–“ãŒãªã„ãªã©
7. **ä»˜ãåˆã„ãƒ»å¤–é£Ÿ** - é£²ã¿ä¼šã€å¤–é£Ÿã€ä»˜ãåˆã„ãªã©
8. **ç¡çœ ãƒ»ä¼‘æ¯** - ç¡çœ ä¸è¶³ã€ç–²ã‚Œã€ä¼‘æ¯ãªã©
9. **ä¸€èˆ¬çš„ãªåŠ±ã¾ã—** - ãã®ä»–å…¨èˆ¬

#### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ§‹é€ 
```
æŒ¨æ‹¶ï¼ˆ20ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
    â†“
å…±æ„Ÿï¼ˆ30ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
    â†“
ã‚«ãƒ†ã‚´ãƒªåˆ¥ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼ˆ40-50ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
    â†“
åŠ±ã¾ã—ï¼ˆ40ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
    â†“
ç· ã‚ã®è¨€è‘‰ï¼ˆ20ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°è¨ˆç®—
- é£Ÿäº‹ãƒ»æ „é¤Š: 20 Ã— 30 Ã— 50 Ã— 40 Ã— 20 = **24,000,000ãƒ‘ã‚¿ãƒ¼ãƒ³**
- é‹å‹•ãƒ»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°: 20 Ã— 30 Ã— 50 Ã— 40 Ã— 20 = **24,000,000ãƒ‘ã‚¿ãƒ¼ãƒ³**
- ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»ãƒ¡ãƒ³ã‚¿ãƒ«: 20 Ã— 30 Ã— 50 Ã— 40 Ã— 20 = **24,000,000ãƒ‘ã‚¿ãƒ¼ãƒ³**
- åœæ»æœŸ: 20 Ã— 30 Ã— 50 Ã— 40 Ã— 20 = **24,000,000ãƒ‘ã‚¿ãƒ¼ãƒ³**
- ä½“é‡å¢—åŠ ãƒ»ãƒªãƒã‚¦ãƒ³ãƒ‰: 20 Ã— 30 Ã— 50 Ã— 40 Ã— 20 = **24,000,000ãƒ‘ã‚¿ãƒ¼ãƒ³**
- æ™‚é–“ç®¡ç†: 20 Ã— 30 Ã— 40 Ã— 40 Ã— 20 = **19,200,000ãƒ‘ã‚¿ãƒ¼ãƒ³**
- ä»˜ãåˆã„ãƒ»å¤–é£Ÿ: 20 Ã— 30 Ã— 40 Ã— 40 Ã— 20 = **19,200,000ãƒ‘ã‚¿ãƒ¼ãƒ³**
- ç¡çœ ãƒ»ä¼‘æ¯: 20 Ã— 30 Ã— 40 Ã— 40 Ã— 20 = **19,200,000ãƒ‘ã‚¿ãƒ¼ãƒ³**
- ä¸€èˆ¬çš„ãªåŠ±ã¾ã—: 20 Ã— 30 Ã— 50 Ã— 40 Ã— 20 = **24,000,000ãƒ‘ã‚¿ãƒ¼ãƒ³**

**åˆè¨ˆ: 201,600,000ãƒ‘ã‚¿ãƒ¼ãƒ³**

### 2. è¿”ä¿¡ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ ï¼ˆresponse_generator.pyï¼‰

#### ä¸»è¦æ©Ÿèƒ½

##### ResponseGeneratorã‚¯ãƒ©ã‚¹
```python
from response_generator import ResponseGenerator

# åˆæœŸåŒ–
generator = ResponseGenerator(api_key="your-gemini-api-key")

# è¿”ä¿¡ç”Ÿæˆ
response = generator.generate_response(
    question="é£Ÿäº‹åˆ¶é™ãŒãã¤ãã¦ç¶šã‘ã‚‰ã‚Œã¾ã›ã‚“",
    user_name="å¤ªéƒ"
)

print(response['message'])
```

##### ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰

**1. `classify_question(question)`**
- è³ªå•ã‚’ã‚«ãƒ†ã‚´ãƒªã«è‡ªå‹•åˆ†é¡
- AIï¼ˆGeminiï¼‰ã‚’ä½¿ç”¨ã—ã¦é«˜ç²¾åº¦ã«åˆ†é¡
- APIã‚­ãƒ¼ãŒãªã„å ´åˆã¯ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°

**2. `generate_response(question, user_name=None)`**
- è¿”ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç”Ÿæˆ
- è¿”ã‚Šå€¤:
  ```python
  {
      "category": "é£Ÿäº‹ãƒ»æ „é¤Š",
      "message": "å¤ªéƒã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼\n\nãã®æ°—æŒã¡...",
      "pattern_count": 24000000,
      "greeting": "ã“ã‚“ã«ã¡ã¯ï¼",
      "empathy": "ãã®æ°—æŒã¡ã€ã¨ã¦ã‚‚ã‚ˆãã‚ã‹ã‚Šã¾ã™ã€‚",
      "advice": "ç‚­æ°´åŒ–ç‰©ã‚’å®Œå…¨ã«æŠœãã‚ˆã‚Š...",
      "encouragement": "ã‚ãªãŸãªã‚‰ã§ãã¾ã™ã‚ˆï¼",
      "closing": "å¿œæ´ã—ã¦ã„ã¾ã™ã‚ˆï¼"
  }
  ```

**3. `get_total_pattern_count()`**
- å…¨ã‚«ãƒ†ã‚´ãƒªã®ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°ã‚’å–å¾—
- ãƒ‡ãƒãƒƒã‚°ãƒ»ç¢ºèªç”¨

## ğŸš€ ä½¿ã„æ–¹

### åŸºæœ¬çš„ãªä½¿ã„æ–¹

```python
#!/usr/bin/env python3
from response_generator import ResponseGenerator

# 1. åˆæœŸåŒ–
generator = ResponseGenerator(api_key="your-gemini-api-key")

# 2. è³ªå•ã«å¯¾ã™ã‚‹è¿”ä¿¡ã‚’ç”Ÿæˆ
question = "é‹å‹•ã™ã‚‹æ™‚é–“ãŒãªãã¦å›°ã£ã¦ã„ã¾ã™"
response = generator.generate_response(question, user_name="èŠ±å­")

# 3. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—
print(response['message'])
```

### APIã‚­ãƒ¼ãªã—ã§ä½¿ã†å ´åˆ

```python
# APIã‚­ãƒ¼ãªã—ã§ã‚‚å‹•ä½œï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°ã§åˆ†é¡ï¼‰
generator = ResponseGenerator()

response = generator.generate_response("ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒç¶šãã¾ã›ã‚“")
print(response['message'])
```

### ã‚«ãƒ†ã‚´ãƒªã ã‘çŸ¥ã‚ŠãŸã„å ´åˆ

```python
generator = ResponseGenerator(api_key="your-api-key")

category = generator.classify_question("é£Ÿã¹éãã¦ä½“é‡ãŒå¢—ãˆã¾ã—ãŸ")
print(f"ã‚«ãƒ†ã‚´ãƒª: {category}")
# å‡ºåŠ›: ã‚«ãƒ†ã‚´ãƒª: ä½“é‡å¢—åŠ ãƒ»ãƒªãƒã‚¦ãƒ³ãƒ‰
```

## ğŸ“± LINE Boté€£æº

### å¿…è¦ãªæº–å‚™

1. **LINE Developersã§ãƒãƒ£ãƒãƒ«ä½œæˆ**
   - https://developers.line.biz/ ã«ã‚¢ã‚¯ã‚»ã‚¹
   - Messaging APIãƒãƒ£ãƒãƒ«ã‚’ä½œæˆ
   - Channel Access Tokenã¨Channel Secretã‚’å–å¾—

2. **ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
   ```bash
   pip install line-bot-sdk flask google-generativeai pillow
   ```

3. **ç’°å¢ƒå¤‰æ•°ã®è¨­å®š**
   ```bash
   export LINE_CHANNEL_ACCESS_TOKEN='your-channel-access-token'
   export LINE_CHANNEL_SECRET='your-channel-secret'
   export GEMINI_API_KEY='your-gemini-api-key'
   ```

### å®Ÿè£…ä¾‹

è©³ç´°ã¯ `line_bot_example.py` ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```python
from flask import Flask, request
from linebot import LineBotApi, WebhookHandler
from linebot.models import MessageEvent, TextMessage, TextSendMessage
from response_generator import ResponseGenerator

app = Flask(__name__)

line_bot_api = LineBotApi('YOUR_CHANNEL_ACCESS_TOKEN')
handler = WebhookHandler('YOUR_CHANNEL_SECRET')
response_generator = ResponseGenerator('YOUR_GEMINI_API_KEY')

@app.route("/callback", methods=['POST'])
def callback():
    signature = request.headers['X-Line-Signature']
    body = request.get_data(as_text=True)
    handler.handle(body, signature)
    return 'OK'

@handler.add(MessageEvent, message=TextMessage)
def handle_message(event):
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    user_message = event.message.text

    # ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å–å¾—
    user_id = event.source.user_id
    profile = line_bot_api.get_profile(user_id)
    user_name = profile.display_name

    # è¿”ä¿¡ã‚’ç”Ÿæˆ
    response = response_generator.generate_response(user_message, user_name)

    # LINEã«è¿”ä¿¡
    line_bot_api.reply_message(
        event.reply_token,
        TextSendMessage(text=response['message'])
    )

if __name__ == "__main__":
    app.run(port=5000)
```

### ã‚µãƒ¼ãƒãƒ¼å…¬é–‹ï¼ˆé–‹ç™ºæ™‚ï¼‰

```bash
# ngrokã§å…¬é–‹
ngrok http 5000

# è¡¨ç¤ºã•ã‚ŒãŸURLã‚’LINE Developersã®Webhook URLã«è¨­å®š
# ä¾‹: https://xxxx-xxxx-xxxx.ngrok.io/callback
```

## ğŸ”§ ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºæ–¹æ³•

### 1. ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è¿½åŠ 

`message_templates.py`ã‚’ç·¨é›†ï¼š

```python
# æ–°ã—ã„æŒ¨æ‹¶ã‚’è¿½åŠ 
GREETINGS.append("ãŠå…ƒæ°—ã§ã™ã‹ï¼")

# æ–°ã—ã„ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’è¿½åŠ 
ADVICE_FOOD.append("ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„é£Ÿäº‹ã‚’å¿ƒãŒã‘ã¾ã—ã‚‡ã†ã€‚")
```

### 2. ã‚«ãƒ†ã‚´ãƒªã®è¿½åŠ 

```python
# 1. ã‚«ãƒ†ã‚´ãƒªåã‚’è¿½åŠ 
CATEGORIES.append("æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒª")

# 2. ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãƒªã‚¹ãƒˆã‚’ä½œæˆ
ADVICE_NEW_CATEGORY = [
    "ã‚¢ãƒ‰ãƒã‚¤ã‚¹1",
    "ã‚¢ãƒ‰ãƒã‚¤ã‚¹2",
    # ...
]

# 3. è¾æ›¸ã«è¿½åŠ 
ADVICE_BY_CATEGORY["æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒª"] = ADVICE_NEW_CATEGORY
```

### 3. ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã®èª¿æ•´

`response_generator.py`ã®`_classify_by_keyword`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç·¨é›†ï¼š

```python
keywords = {
    "é£Ÿäº‹ãƒ»æ „é¤Š": ["é£Ÿäº‹", "æ „é¤Š", "ã‚«ãƒ­ãƒªãƒ¼", "ãŠè…¹", "ç©ºè…¹"],  # ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¿½åŠ 
    # ...
}
```

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- **åˆ†é¡é€Ÿåº¦**: ç´„0.5-1ç§’ï¼ˆAIä½¿ç”¨æ™‚ï¼‰/ 0.01ç§’æœªæº€ï¼ˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒãƒãƒ³ã‚°ï¼‰
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆé€Ÿåº¦**: 0.01ç§’æœªæº€
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡**: ç´„10-20MB

## âš ï¸ æ³¨æ„äº‹é …

1. **APIã‚­ãƒ¼ã®ç®¡ç†**
   - ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
   - ã‚³ãƒ¼ãƒ‰ã«ç›´æ¥æ›¸ã‹ãªã„
   - `.gitignore`ã«è¿½åŠ 

2. **Gemini APIã®åˆ¶é™**
   - ç„¡æ–™æ : æœˆé–“15ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/åˆ†
   - åˆ¶é™ã‚’è¶…ãˆã‚‹å ´åˆã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã®å®Ÿè£…ã‚’æ¨å¥¨

3. **LINE Messaging APIã®åˆ¶é™**
   - ãƒ•ãƒªãƒ¼ãƒ—ãƒ©ãƒ³: æœˆ500é€šã¾ã§
   - ãƒ—ãƒƒã‚·ãƒ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æœ‰æ–™

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

ãƒ‡ãƒ¢ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œï¼š

```bash
python response_generator.py
```

å‡ºåŠ›ä¾‹ï¼š
```
============================================================
ğŸ¤– ãƒ€ã‚¤ã‚¨ãƒƒãƒˆãƒ¡ãƒ³ã‚¿ãƒ¼ è‡ªå‹•è¿”ä¿¡ã‚·ã‚¹ãƒ†ãƒ 
============================================================

ğŸ“Š åˆ©ç”¨å¯èƒ½ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°ï¼š
------------------------------------------------------------
   é£Ÿäº‹ãƒ»æ „é¤Š: 24,000,000ãƒ‘ã‚¿ãƒ¼ãƒ³
   é‹å‹•ãƒ»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°: 24,000,000ãƒ‘ã‚¿ãƒ¼ãƒ³
   ...
------------------------------------------------------------
âœ¨ åˆè¨ˆ: 201,600,000ãƒ‘ã‚¿ãƒ¼ãƒ³

============================================================
ğŸ’¬ è¿”ä¿¡ä¾‹ï¼ˆ5ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
============================================================

ã€è³ªå•ã€‘å¤ªéƒã•ã‚“: é£Ÿäº‹åˆ¶é™ãŒãã¤ãã¦ç¶šã‘ã‚‰ã‚Œã¾ã›ã‚“
------------------------------------------------------------
ğŸ“ åˆ†é¡ã‚«ãƒ†ã‚´ãƒª: é£Ÿäº‹ãƒ»æ „é¤Š
ğŸ”¢ ã“ã®ã‚«ãƒ†ã‚´ãƒªã®ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°: 24,000,000

ã€è¿”ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€‘
å¤ªéƒã•ã‚“ã€ã“ã‚“ã«ã¡ã¯ï¼

ãã®æ°—æŒã¡ã€ã¨ã¦ã‚‚ã‚ˆãã‚ã‹ã‚Šã¾ã™ã€‚

å®Œç’§ã˜ã‚ƒãªãã¦ã„ã„ã€7å‰²ã§ãã‚Œã°OKã§ã™ã€‚

ã‚ãªãŸãªã‚‰ã§ãã¾ã™ã‚ˆï¼

å¿œæ´ã—ã¦ã„ã¾ã™ã‚ˆï¼
============================================================
```

## ğŸ“š å‚è€ƒè³‡æ–™

- [LINE Messaging API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developers.line.biz/ja/docs/messaging-api/)
- [Google Gemini API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://ai.google.dev/docs)
- [Flask ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://flask.palletsprojects.com/)

## ğŸ™ ã‚µãƒãƒ¼ãƒˆ

è³ªå•ã‚„å•é¡ŒãŒã‚ã‚Œã°ã€GitHubã®Issueã§å ±å‘Šã—ã¦ãã ã•ã„ã€‚
